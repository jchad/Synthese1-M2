<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gKit2 light: récupérer les uniforms et les attributs utilisés par un shader program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">gKit2 light
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">récupérer les uniforms et les attributs utilisés par un shader program</div>  </div>
</div><!--header-->
<div class="contents">
<p>cf <a class="el" href="tuto3GL__reflect_8cpp.html">tuto3GL_reflect.cpp</a></p>
<h1><a class="anchor" id="autotoc_md56"></a>
lister les uniforms utilisés par un program</h1>
<p>en plus des glGetUniformLocation( ), l'objet openGL program maintient la liste complètes des uniforms, leur noms, leur type, leur <b>valeur</b> et bien sur leur identifiant / location. glGetActiveUniform( ) permet de récupérer ces informations, mais il faut d'abord obtenir le nombre total d'uniform avec glGetProgram( ) :</p>
<div class="fragment"><div class="line">GLuint progam= ... ;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer le nombre total d&#39;uniforms</span></div>
<div class="line">GLint n= 0;</div>
<div class="line">glGetProgramiv(program, GL_ACTIVE_UNIFORMS, &amp;n);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer la longueur max occuppee par un nom d&#39;uniform</span></div>
<div class="line">GLint length_max= 0;</div>
<div class="line">glGetProgramiv(program, GL_ACTIVE_UNIFORM_MAX_LENGTH, &amp;length_max);</div>
<div class="line"><span class="comment">// allouer une chaine de caractere</span></div>
<div class="line"><span class="keywordtype">char</span> *name= <span class="keyword">new</span> <span class="keywordtype">char</span> [length_max];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer les infos de chaque uniform</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> index= 0; index &lt; n; index++)</div>
<div class="line">{</div>
<div class="line">    GLint glsl_size;</div>
<div class="line">    GLenum glsl_type;</div>
<div class="line">    glGetActiveUniform(program, index, length_max, NULL, &amp;glsl_size, &amp;glsl_type, name);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// et son identifiant</span></div>
<div class="line">    GLint location= glGetUniformLocation(program, name);</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;uniform %d &#39;%s&#39;: location %d, type %x, array_size %d\n&quot;</span>, index, name, location, glsl_type, glsl_size);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">delete</span> [] name;</div>
</div><!-- fragment --><p>récupérer la valeur actuelle d'un uniform est plus long, puisque la fonction qui renvoie la valeur dépend du type de l'uniform. pour les types les plus courants, on peut écrire quelquechose comme ça : </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> print_uniform( <span class="keyword">const</span> GLuint program, <span class="keyword">const</span> <span class="keywordtype">int</span> index, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> GLenum type )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ivalue= 0;</div>
<div class="line">    <span class="keywordtype">float</span> fvalues[16]= {};</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">switch</span>(type)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> GL_BOOL:</div>
<div class="line">            glGetUniformiv(program, index, &amp;ivalue);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type bool (%x), value= %s\n&quot;</span>, name, type, ivalue ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> GL_INT:</div>
<div class="line">            glGetUniformiv(program, index, &amp;ivalue);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type int (%x), value= %d\n&quot;</span>, name, type, ivalue);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> GL_FLOAT:</div>
<div class="line">            glGetUniformfv(program, index, fvalues);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type float (%x), value= %f\n&quot;</span>, name, type, fvalues[0]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> GL_FLOAT_VEC2:</div>
<div class="line">            glGetUniformfv(program, index, fvalues);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type vec2 (%x), values= %f %f\n&quot;</span>, name, type, fvalues[0], fvalues[1]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> GL_FLOAT_VEC3:</div>
<div class="line">            glGetUniformfv(program, index, fvalues);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type vec3 (%x), values= %f %f %f\n&quot;</span>, name, type, fvalues[0], fvalues[1], fvalues[2]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> GL_FLOAT_VEC4:</div>
<div class="line">            glGetUniformfv(program, index, fvalues);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type vec4 (%x), values= %f %f %f %f\n&quot;</span>, name, type, fvalues[0], fvalues[1], fvalues[2], fvalues[3]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">            </div>
<div class="line">        <span class="keywordflow">case</span> GL_FLOAT_MAT4:</div>
<div class="line">            glGetUniformfv(program, index, fvalues);</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type mat4 (%x), values=\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r= 0; r &lt; 4; r++)</div>
<div class="line">            {</div>
<div class="line">                <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;    &quot;</span>);</div>
<div class="line">                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c= 0; c &lt; 4; c++)</div>
<div class="line">                    <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;%f &quot;</span>, fvalues[c*4 + r]);</div>
<div class="line">                <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;  uniform &#39;%s&#39;, type %x, type unknown\n&quot;</span>, name, type);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>on peut utiliser cette fonction à chaque draw, pour vérifier que tous les uniforms ont bien une valeur correcte ou la modifier pour n'afficher un message que lorsqu'un uniform est égal à zero, ce qui peut signifier que l'application ne lui a pas donné de valeur...</p>
<p>exemple complet, avec un affichage mieux formaté et la gestion des tableaux d'uniforms, dans <a class="el" href="tuto3GL__reflect_8cpp.html">tuto3GL_reflect.cpp</a></p>
<h1><a class="anchor" id="autotoc_md57"></a>
lister les attributs utilisés par un program / vertex shader</h1>
<p>la démarche est la même que pour les uniforms, il faut récupérer le nombre total d'attributs, la longueur max des noms, cf glGetProgram( ).</p>
<div class="fragment"><div class="line">GLuint progam= ... ;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer le nombre total d&#39;attributs</span></div>
<div class="line">GLint n= 0;</div>
<div class="line">glGetProgramiv(program, GL_ACTIVE_ATTRIBUTES, &amp;n);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer la longueur max occuppee par un nom d&#39;attribut</span></div>
<div class="line">GLint length_max= 0;</div>
<div class="line">glGetProgramiv(program, GL_ACTIVE_ATTRIBUTE_MAX_LENGTH, &amp;length_max);</div>
<div class="line"><span class="comment">// allouer une chaine de caractere</span></div>
<div class="line"><span class="keywordtype">char</span> *name= <span class="keyword">new</span> <span class="keywordtype">char</span> [length_max];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// recuperer les infos de chaque attribut</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> index= 0; index &lt; n; index++)</div>
<div class="line">{</div>
<div class="line">    GLint glsl_size;</div>
<div class="line">    GLenum glsl_type;</div>
<div class="line">    glGetActiveAttrib(program, index, length_max, NULL, &amp;glsl_size, &amp;glsl_type, name);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// et son identifiant</span></div>
<div class="line">    GLint location= glGetAttribLocation(program, name);</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;attribute %d &#39;%s&#39;: location %d, type %x, array_size %d\n&quot;</span>, index, name, location, glsl_type, glsl_size);</div>
<div class="line">}</div>
<div class="line"><span class="keyword">delete</span> [] name;</div>
</div><!-- fragment --><p>exemple complet dans <a class="el" href="tuto3GL__reflect_8cpp.html">tuto3GL_reflect.cpp</a></p>
<p>il est également possible récupérer quel buffer est associé à un attribut, cf glGetVertexAttrib( ) pour vérifier que tout est cohérent au moment du glDraw( ). c'est le vertex array object qui conserve ces informations, cf <a class="el" href="group__tuto4GL.html">configurer un format de sommet, vertex array object</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// selectionner le vertex array, si necessaire</span></div>
<div class="line"><span class="comment">// glBindVertexArray(vao);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// recupere le buffer associe a l&#39;attribut d&#39;indice id, dans le vertex array selectionne</span></div>
<div class="line">GLint buffer= 0; </div>
<div class="line">glGetVertexAttribiv(index, GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING, &amp;buffer);</div>
<div class="line"><a class="code" href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a>(<span class="stringliteral">&quot;attribute %d: buffer %d\n&quot;</span>, index, buffer);</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="agroup__application_html_ga6efbb9298a8f73b9a17959b56ec20267"><div class="ttname"><a href="group__application.html#ga6efbb9298a8f73b9a17959b56ec20267">printf</a></div><div class="ttdeci">void printf(Text &amp;text, const int px, const int py, const char *format,...)</div><div class="ttdoc">affiche un texte a la position x, y. meme utilisation que printf().</div><div class="ttdef"><b>Definition:</b> <a href="text_8cpp_source.html#l00140">text.cpp:140</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Sep 9 2019 15:39:11 for gKit2 light by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
